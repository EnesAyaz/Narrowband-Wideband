clear ;
clc;
tic;
%% Time array
ma = 0.90;
fout = 100; % Hz
fsw = 1e3; % Hz
Tstep=1e-6;
Ts = Tstep; % s
Tfinal =2/fout ; % s
time_array = 0:Tstep:Tfinal-Tstep;
NumberofSteps = numel(time_array);
%Generate switching signals
The_c=0;
The_f=-pi;
phaseP=The_f+0;
phaseN=The_f-pi;
VrefP = ma*cos(2*pi*fout*time_array+phaseP);
VrefN = ma*cos(2*pi*fout*time_array+phaseN);
Vtriang = zeros(1, NumberofSteps);
for k = 1:Tfinal*fsw
   Triang_temp = triang(1/(Ts*fsw));
   Vtriang((length(Triang_temp)*(k-1)+1:k/(Tstep*fsw))) = (Triang_temp*2)-1;
end

carrierPhP=0;
carrierPhN=pi;
carP= round(carrierPhP/(fsw*Ts)/360);
if carP==0
    carP=1;
end
carN= round(carrierPhN/(fsw*Ts)/360);
if carN==0
    carN=1;
end

VcarrierP = [ Vtriang(carP:end), zeros(1,carP-1)];
VcarrierN = [ Vtriang(carN:end), zeros(1,carN-1)];

SP = double(VrefP > VcarrierP);
SN = double(VrefN > VcarrierN);

%%
Itx = 1*cos(2*pi*fout*time_array)+ 1*cos(2*pi*fsw*time_array);
Itx = (1*cos(2*pi*(fsw-2*fout)*time_array)+ 1*cos(2*pi*fsw*time_array))*0.2;

% plot(SP)
% hold on;
% % plot((1-SP)/2);
% % hold on
% plot(Itx)
% ylim([-0.5 1.2])


figure1 = figure('Renderer', 'painters', 'Position', [10 10 1020 420]);

% Create axes
axes1 = axes('Parent',figure1);
hold(axes1,'on');

% Create multiple line objects using matrix input to plot
plot1 = plot(SP,'LineWidth',1.5);
plot2 = plot(Itx,'LineWidth',1.5);
set(plot1,'DisplayName','V_{DS}',...
    'Color',[0.196078431372549 0.196078431372549 0.858823529411765]);
set(plot2,'DisplayName','I_{Tx}',...
    'Color',[0.870588235294118 0.0941176470588235 0.211764705882353]);

% Uncomment the following line to preserve the Y-limits of the axes
ylim(axes1,[-0.5 1.2]);
box(axes1,'on');
hold(axes1,'off');
% Set the remaining axes properties
set(axes1,'FontName','Times New Roman','FontSize',20,'XTick',zeros(1,0),...
    'YTick',[-0.38 0 0.38 1],'YTickLabel',{'-I_{Tx}','0','I_{Tx}','V_{DS}'});
% Create legend
legend1 = legend(axes1,'show');
set(legend1,...
    'Position',[0.563474236384623 0.102291313334665 0.104571246194813 0.167857138173921],...
    'FontSize',20,...
    'EdgeColor','none',...
    'Color','none');
% Create rectangle
annotation(figure1,'rectangle',...
    [0.169241642084572 0.105422044207093 0.00688298918387389 0.816666666666668],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.212389380530974 0.106408544726302 0.00688298918387387 0.816666666666667],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.374110435103247 0.104331701527964 0.00688298918387381 0.816666666666667],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.409046214355951 0.107751075508085 0.00688298918387387 0.816666666666668],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.479959439528026 0.10402759234535 0.00688298918387387 0.816666666666668],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.51692016961652 0.105370123127133 0.00688298918387364 0.816666666666668],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.598878441494596 0.104331701527964 0.00688298918387387 0.816666666666668],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.761582780235994 0.104939919893192 0.00688298918387398 0.816666666666668],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.797097775319572 0.105066013944519 0.00688298918387387 0.816666666666668],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

% Create rectangle
annotation(figure1,'rectangle',...
    [0.866273352999021 0.104761904761905 0.00688298918387387 0.816666666666668],...
    'Color','none',...
    'FaceColor',[0 1 0],...
    'FaceAlpha',0.4);

